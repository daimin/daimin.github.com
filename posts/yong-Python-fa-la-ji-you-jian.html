<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0025)http://daimin.github.io/ -->
<html>
<head>
    

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="keywords" content="用Python发垃圾邮件" />
    <meta name="description" content="这个程序写了很久了，是刚开始学习python的时候写的，主要就是抓取页面的邮箱，然后发送。直接看代码..." />
    <link rel="shortcut icon" href="/favicon.ico" />

    <title>用Python发垃圾邮件 | 茶瓯葱丝</title>
    <link rel="stylesheet" type="text/css" href="/styles/style.css">
    <link rel="Stylesheet" type="text/css" href="/js/prettify/desert.css" />
    <link rel="stylesheet" type="text/css" href="/styles/bootstrap-jian.css">
    <script type="text/javascript"  src="/js/prettify/prettify.js"></script>
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://daimin.github.io/rss.xml">
</head>
<body>
		<div id="logo">
			<span id="motto"></span>
			<h1><a href="/index.html" >茶瓯葱丝</a>
            <form onsubmit="return dispatch()" style="display:inline">
            <span style="width: 240px; height: 26px; margin-left:24px; background-size: 240px 26px; background-image: url('/image/qbar_light@2x.png'); background-repeat: no-repeat; display: inline-block;">
            <input type="text" maxlength="40" name="q" id="q" value="">
            </span>
            </form>
            </h1>
            
        </div>
<div id="wrapper">
<div id="content" class="index">
     
<div id="sidebar">
        <ul>
            <li>
                <a href="/index.html">首页</a>
                <ul>
                        <li><a href="/tags/python.html" title="python"> python</a></li>
                        <li><a href="/tags/php.html" title="php"> php</a></li>
                        <li><a href="/tags/nginx.html" title="nginx"> nginx</a></li>
                        <li><a href="/tags/markdown.html" title="markdown"> markdown</a></li>
                        <li><a href="/tags/java.html" title="java"> java</a></li>
                </ul>
            </li>
            <li><a href="/tags/">标签</a></li>
            <li><a href="http://daimin.github.io/rss.xml">订阅</a></li>
            <li><a href="/links.html">友链</a></li>
            <li><a href="/docs/index.html">文档</a></li>
                <li><a href="/posts/liu-yan-ban.html" title="留言">留言</a></li>
            
        </ul>
<a href="http://s11.flagcounter.com/more/2dzW"><img src="https://s11.flagcounter.com/count2/2dzW/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
<!--         <div class="ad-panel" onclick="location.href='https://www.facebook.com/NancyatJarliet'" style="cursor: pointer;">
            <div class="ad-desc">
            <p>实体娃娃(Sex Doll).<br/><a href="mailto:sales5@jarliet.com">sales5@jarliet.com</a></p>
            </div>
           <img src="/image/ads/erwama.jpg" style="float:right;margin-top:3px;" /> 
        </div> -->
        
    </div>

<div id="main">
<h2 class="post-title">用Python发垃圾邮件</h2>
<div class="cnt">
<p><img alt="qiniu_1376907717364.jpg" src="http://vaga-static.qiniudn.com/qiniu_1376907717364.jpg" title="解析页面发邮件" /></p>
<blockquote>
<p>这个程序写了很久了，是刚开始学习python的时候写的，主要就是抓取页面的邮箱，然后发送。直接看代码吧，是我少有的注释比较详细的代码了，希望会有点参考价值。</p>
</blockquote>
<pre><code>#!/usr/bin/python

# -*- coding:UTF-8 -*-

#encoding=utf-8

#author:daimin(vagasnail#gmail.com)

"""

  1 能发送到多个邮箱

  2 使用多线程

  3 抓取指定的网页得到网页中的邮箱，然后发送(通过命令行参数获取网页地址)

"""

import sys

import smtplib

from email.Message import Message

from time import sleep

import threading

import urllib2,urllib

from BeautifulSoup import BeautifulSoup

from BeautifulSoup import BeautifulStoneSoup

import re





to_addrs = ['target@xx.com']       #目标邮箱

cc_addr = 'cc@xx.com'              #抄送

from_addr = 'from@xxx.com'         #发送邮箱



# 标题和正文

    subject = u'这不是垃圾邮件' # u表示该字符使用unicode方式编码，注意这里只是起指示作用，用于一些函数处理

    content = u'你好，测试用的'



    class MyThread(threading.Thread):

    # const

    smtpserver = 'smtp.gmail.com'

    username = 'vagasnail@gmail.com'

    password = 'dai253685'





    def __init__(self,no,msg,to_addr):

        threading.Thread.__init__(self) # 调用parent的__init__方法

        self.no = no

        self.msg = msg

        self.to_addr = to_addr



    def run(self):

        self.send_message()



    def send_message(self):

        print " start thread %d ....\n" % (self.no)

        sm = smtplib.SMTP(MyThread.smtpserver, port=587, timeout=20)

        sm.set_debuglevel(1)                   #开启debug模式

        sm.ehlo()

        sm.starttls()                          #使用安全连接

        sm.ehlo()

        sm.login(MyThread.username, MyThread.password)



        sm.sendmail(from_addr, self.to_addr, self.msg)

        sleep(5)

        sm.quit()



# 使用urllib2 获取html文档

# 使用BeautifulSoup解析html文档

def get_to_addrs(url):

    #pattern = re.compile(r'^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$')

    pattern = re.compile(r'\w+[\.\w]+@\w+\.\w+')

    global to_addrs

    req = urllib2.Request(url)

    res = urllib2.urlopen(req, timeout=10)

    html = res.read()

    res.close()



    match = pattern.findall(html)

    to_addrs.extend(match)

    #soup = BeautifulStoneSoup(html)

    '''

    ass = soup.findAll("a")

    for a in ass:

        h = a.get('href')

        if h &lt;&gt; None:

            h = h.strip()

            pos = h.find(tag)

            if pos &lt;&gt; -1:

                mail = h.replace(tag,'')

                mail = mail.strip()

                to_addrs.append(mail)

    '''



if __name__ == "__main__":

    """

因为解码是python自动进行的，我们没有指明解码方式，python 就会使用 sys.defaultencoding 指明的方式来解码。

很多情况下 sys.defaultencoding 是 ANSCII，如果 s 不是这个类型就会出错。

拿上面的情况来说，我的 sys.defaultencoding 是 anscii，而 s 的编码方式和文件的编码方式一致，是 utf8 的。

你可以明确的s.decode(xxx).encode(xxxx)来编码解码 (解码：将编码解释为字符串，编码：将字符串编码)

    """

    reload(sys)  # Python2.5 初始化后会删除 sys.setdefaultencoding 这个方法，我们需要重新载入

    sys.setdefaultencoding( "utf-8" )



    if len(sys.argv) &lt;&gt; 2:

        print "    Please input target page's url which you want handle!"

        exit(0)



    url = sys.argv[1]

    get_to_addrs(url)

    print to_addrs



    tno = 1

    for to_addr in to_addrs:

        message = Message()

        #message.set_charset('')





        message['Subject'] = subject    #邮件标题

        message['From'] = from_addr

        message['To'] = to_addr

        message['Cc'] = cc_addr

        message.set_payload(content)    #邮件正文

        msg = message.as_string()

        #send_message(tno,msg,to_addr)

        t = MyThread(tno,msg,to_addr)

        t.start()

        tno = tno + 1
</code></pre>
</div>

<div style="margin-top:24px;margin-bottom:12px;display: block;">
<hr/>
</div>
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1794396"></script>
<!-- UY END -->

</div>


</div>
<div id="footer">
	<span style="color:#bbb;font-size:12px">
	&copy; Powered by <a href="https://github.com/daimin/daimin.github.com" title="sologs">sologs</a> 
	</span>
	<p style="clear:both"></p>
</div>
</div>
<script type="text/javascript">
function hasClass(obj, cls) {  
    return obj.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));  
}
function addClass(obj, cls) {  
    if (!this.hasClass(obj, cls)) obj.className += " " + cls;  
} 

function render_pretty(){
    var pres = document.getElementsByTagName("pre");
    for(var i = 0, len = pres.length; i < len; i++){
        addClass(pres[i], "prettyprint");
    }
    prettyPrint();

}

(function(){
   var mattos = [
   "人生没有对错，只有选择后的坚持，不后悔，走下去，就是对的。",
   "生活是一面镜子。你对它笑，它就对你笑；你对它哭，它也对你哭。",
   "宁愿做过了后悔，也不要错过了后悔。",
   "不要拿小人的错误来惩罚自己，不要在这些微不足道的事情上折磨浪费自己的宝贵时间。",
   "环境不会改变，解决之道在于改变自己。",
   "勇气是控制恐惧心理，而不是心里毫无恐惧。",
   "两个人共尝一个痛苦只有半个痛苦，两个人共享一个欢乐却有两个欢乐。",
   "好好管教自己，不要管别人。",
   "得之坦然，失之淡然，顺其自然，争其必然。",
   "人生是一条没有回程的单行线，上帝不会给你一张返程的票。",
   "把事情办好的秘密就是行动。成功之路就是有条理思考之后的行动！行动！行动！",
   "人生是一场旅行，在乎的不是目的地，是沿途的风景以及看风景的心情。",
   "放弃谁都可以，千万不要放弃自己！",
   "长得漂亮是优势，活得漂亮是本事。",
   "人生最大的错误是不断担心会犯错。",
   "一个人可以被毁灭，但不能给打败 -- 《老人与海》。",
   "要么不要开始，要么不要结束。",
   ];
   document.getElementById("motto").innerHTML = mattos[parseInt(Math.random() * mattos.length)];
   
})();

window.onload = function(){
   render_pretty();
};

var dispatch = function() {
    q = document.getElementById("q");
    if (q.value != "") {
        //window.open('http://www.baidu.com/s?si=daimin.github.io&cl=3&ct=2097152&tn=bds&word=' + q.value, "_blank");
        window.open('https://www.google.com.hk/search?q=site:daimin.github.io ' + q.value + '&gws_rd=cr,ssl', '_blank');
        return false;
    } else {
        return false;
    }
};

</script>
<script type="text/javascript" src="/js/jimdoclockzip.js"></script>
<script type="text/javascript">
var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5814730'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s23.cnzz.com/stat.php%3Fid%3D5814730%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
</script>
<!-- JiaThis Button BEGIN -->
<div class="jiathis_share_slide jiathis_share_24x24" id="jiathis_share_slide">
<div class="jiathis_share_slide_top" id="jiathis_share_title"></div>
<div class="jiathis_share_slide_inner">
<div class="jiathis_style_24x24">
<a class="jiathis_button_qzone"></a>
<a class="jiathis_button_tsina"></a>
<a class="jiathis_button_tqq"></a>
<a class="jiathis_button_weixin"></a>
<a class="jiathis_button_renren"></a>
<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'
	,slide:{
		divid:'jiathis_main',
		pos:'right'
	}
};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1355186795124515" charset="utf-8"></script>	
<script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_slide.js" charset="utf-8"></script>
</div></div></div>
<!-- JiaThis Button END -->
</body>
</html>
